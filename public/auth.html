<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Supercooked - Login</title>
    <style>
      @import "tailwindcss";

      body {
        margin: 0;
        padding: 0;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .auth-container {
        background: white;
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        padding: 40px;
        width: 100%;
        max-width: 400px;
        margin: 20px;
      }

      .auth-header {
        text-align: center;
        margin-bottom: 30px;
      }

      .auth-title {
        font-size: 32px;
        font-weight: 700;
        color: #2d3748;
        margin: 0 0 8px 0;
      }

      .auth-subtitle {
        font-size: 16px;
        color: #718096;
        margin: 0;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-label {
        display: block;
        font-size: 14px;
        font-weight: 600;
        color: #4a5568;
        margin-bottom: 8px;
      }

      .form-input {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 16px;
        transition: all 0.2s;
        box-sizing: border-box;
      }

      .form-input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .form-button {
        width: 100%;
        padding: 14px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
      }

      .form-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
      }

      .form-button:active {
        transform: translateY(0);
      }

      .form-button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .form-switch {
        text-align: center;
        margin-top: 20px;
        font-size: 14px;
        color: #718096;
      }

      .form-switch-link {
        color: #667eea;
        text-decoration: none;
        font-weight: 600;
        cursor: pointer;
      }

      .form-switch-link:hover {
        text-decoration: underline;
      }

      .error-message {
        background: #fed7d7;
        color: #c53030;
        padding: 12px 16px;
        border-radius: 8px;
        margin-bottom: 20px;
        font-size: 14px;
        text-align: center;
      }

      .success-message {
        background: #c6f6d5;
        color: #2f855a;
        padding: 12px 16px;
        border-radius: 8px;
        margin-bottom: 20px;
        font-size: 14px;
        text-align: center;
      }

      .hidden {
        display: none;
      }

      .loading {
        display: inline-block;
        width: 16px;
        height: 16px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: white;
        animation: spin 0.6s linear infinite;
        vertical-align: middle;
        margin-left: 8px;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <div class="auth-container">
      <div class="auth-header">
        <h1 class="auth-title">üç≥ Supercooked</h1>
        <p class="auth-subtitle" id="auth-subtitle">
          Sign in to start cooking!
        </p>
      </div>

      <div id="error-message" class="error-message hidden"></div>
      <div id="success-message" class="success-message hidden"></div>

      <!-- Login Form -->
      <form id="login-form">
        <div class="form-group">
          <label class="form-label" for="login-username">Username</label>
          <input
            type="text"
            id="login-username"
            class="form-input"
            placeholder="Enter your username"
            required
            autocomplete="username"
          />
        </div>

        <div class="form-group">
          <label class="form-label" for="login-password">Password</label>
          <input
            type="password"
            id="login-password"
            class="form-input"
            placeholder="Enter your password"
            required
            autocomplete="current-password"
          />
        </div>

        <button type="submit" class="form-button" id="login-button">
          Sign In
        </button>

        <div class="form-switch">
          Don't have an account?
          <a class="form-switch-link" id="show-register">Create one</a>
        </div>
      </form>

      <!-- Register Form -->
      <form id="register-form" class="hidden">
        <div class="form-group">
          <label class="form-label" for="register-username">Username</label>
          <input
            type="text"
            id="register-username"
            class="form-input"
            placeholder="Choose a username"
            required
            autocomplete="username"
            minlength="3"
            maxlength="50"
          />
          <small
            style="
              color: #718096;
              font-size: 12px;
              display: block;
              margin-top: 4px;
            "
          >
            3-50 characters, letters, numbers, - and _ only
          </small>
        </div>

        <div class="form-group">
          <label class="form-label" for="register-display-name"
            >Display Name</label
          >
          <input
            type="text"
            id="register-display-name"
            class="form-input"
            placeholder="Your chef name"
            required
            maxlength="50"
          />
        </div>

        <div class="form-group">
          <label class="form-label" for="register-password">Password</label>
          <input
            type="password"
            id="register-password"
            class="form-input"
            placeholder="Create a password"
            required
            autocomplete="new-password"
            minlength="6"
          />
          <small
            style="
              color: #718096;
              font-size: 12px;
              display: block;
              margin-top: 4px;
            "
          >
            At least 6 characters
          </small>
        </div>

        <div class="form-group">
          <label class="form-label" for="register-password-confirm"
            >Confirm Password</label
          >
          <input
            type="password"
            id="register-password-confirm"
            class="form-input"
            placeholder="Confirm your password"
            required
            autocomplete="new-password"
            minlength="6"
          />
        </div>

        <button type="submit" class="form-button" id="register-button">
          Create Account
        </button>

        <div class="form-switch">
          Already have an account?
          <a class="form-switch-link" id="show-login">Sign in</a>
        </div>
      </form>
    </div>

    <script type="module">
      const loginForm = document.getElementById("login-form");
      const registerForm = document.getElementById("register-form");
      const errorMessage = document.getElementById("error-message");
      const successMessage = document.getElementById("success-message");
      const authSubtitle = document.getElementById("auth-subtitle");

      const showError = (message) => {
        errorMessage.textContent = message;
        errorMessage.classList.remove("hidden");
        successMessage.classList.add("hidden");
      };

      const showSuccess = (message) => {
        successMessage.textContent = message;
        successMessage.classList.remove("hidden");
        errorMessage.classList.add("hidden");
      };

      const hideMessages = () => {
        errorMessage.classList.add("hidden");
        successMessage.classList.add("hidden");
      };

      // Switch between login and register
      document.getElementById("show-register").addEventListener("click", () => {
        loginForm.classList.add("hidden");
        registerForm.classList.remove("hidden");
        authSubtitle.textContent = "Create your chef account!";
        hideMessages();
      });

      document.getElementById("show-login").addEventListener("click", () => {
        registerForm.classList.add("hidden");
        loginForm.classList.remove("hidden");
        authSubtitle.textContent = "Sign in to start cooking!";
        hideMessages();
      });

      // Login handler
      loginForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        hideMessages();

        const username = document.getElementById("login-username").value.trim();
        const password = document.getElementById("login-password").value;
        const loginButton = document.getElementById("login-button");

        loginButton.disabled = true;
        loginButton.innerHTML = 'Signing In<span class="loading"></span>';

        try {
          const response = await fetch("/api/auth/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ username, password }),
          });

          const data = await response.json();

          if (data.success) {
            // Save session token
            localStorage.setItem("sessionToken", data.sessionToken);
            localStorage.setItem("user", JSON.stringify(data.user));

            showSuccess("Login successful! Redirecting...");
            setTimeout(() => {
              window.location.href = "/";
            }, 1000);
          } else {
            showError(data.error || "Login failed");
            loginButton.disabled = false;
            loginButton.textContent = "Sign In";
          }
        } catch (error) {
          showError("Connection error. Please try again.");
          loginButton.disabled = false;
          loginButton.textContent = "Sign In";
        }
      });

      // Register handler
      registerForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        hideMessages();

        const username = document
          .getElementById("register-username")
          .value.trim();
        const displayName = document
          .getElementById("register-display-name")
          .value.trim();
        const password = document.getElementById("register-password").value;
        const passwordConfirm = document.getElementById(
          "register-password-confirm"
        ).value;
        const registerButton = document.getElementById("register-button");

        // Validate passwords match
        if (password !== passwordConfirm) {
          showError("Passwords do not match");
          return;
        }

        registerButton.disabled = true;
        registerButton.innerHTML =
          'Creating Account<span class="loading"></span>';

        try {
          const response = await fetch("/api/auth/register", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              username,
              password,
              displayName,
              skinIndex: 0, // Default skin
            }),
          });

          const data = await response.json();

          if (data.success) {
            // Save session token
            localStorage.setItem("sessionToken", data.sessionToken);
            localStorage.setItem("user", JSON.stringify(data.user));

            showSuccess("Account created! Redirecting...");
            setTimeout(() => {
              window.location.href = "/";
            }, 1000);
          } else {
            showError(data.error || "Registration failed");
            registerButton.disabled = false;
            registerButton.textContent = "Create Account";
          }
        } catch (error) {
          showError("Connection error. Please try again.");
          registerButton.disabled = false;
          registerButton.textContent = "Create Account";
        }
      });

      // Check if already logged in
      const sessionToken = localStorage.getItem("sessionToken");
      if (sessionToken) {
        fetch("/api/auth/validate", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ sessionToken }),
        })
          .then((res) => res.json())
          .then((data) => {
            if (data.valid) {
              window.location.href = "/";
            }
          })
          .catch(() => {
            // Invalid session, stay on login page
          });
      }
    </script>
  </body>
</html>
